{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{1235:function(s,e,a){\"use strict\";a.r(e);var t=a(42),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":s.$parent.slotKey}},[t(\"h1\",{attrs:{id:\"chinahrss使用docker-compose部署\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#chinahrss使用docker-compose部署\"}},[s._v(\"#\")]),s._v(\" chinahrss使用Docker Compose部署\")]),s._v(\" \"),t(\"p\",[s._v(\"我们使用Docker Compose 一键部署我们的微服务。主要分为三部分:\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"部署ELK\")]),s._v(\" \"),t(\"li\",[s._v(\"部署第三方服务（MySQL、Redis和RabbitMQ）\")]),s._v(\" \"),t(\"li\",[s._v(\"部署自己编写的微服务\")])]),s._v(\" \"),t(\"h2\",{attrs:{id:\"_2-部署第三方服务\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-部署第三方服务\"}},[s._v(\"#\")]),s._v(\" 2. 部署第三方服务\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_2-1-创建存储第三方服务docker-compose文件目录\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-1-创建存储第三方服务docker-compose文件目录\"}},[s._v(\"#\")]),s._v(\" 2.1 创建存储第三方服务Docker Compose文件目录：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"mkdir -p /chinahrss/third-part\\n\")])])]),t(\"h3\",{attrs:{id:\"_2-2-新建docker-compose-yml文件\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-2-新建docker-compose-yml文件\"}},[s._v(\"#\")]),s._v(\" 2.2 新建docker-compose.yml文件\")]),s._v(\" \"),t(\"p\",[s._v(\"在该目录下新建一个docker-compose.yml文件：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"vim /chinahrss/third-part/docker-compose.yml\\n\")])])]),t(\"p\",[s._v(\"内容如下\")]),s._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"version: '3'\\n\\nservices:\\n  mysql:\\n    image: mysql:5.7.24\\n    container_name: mysql\\n    environment:\\n      MYSQL_ROOT_PASSWORD: 123456\\n    ports:\\n      - 13306:3306\\n    volumes:\\n      - /chinahrss/mysql/data:/var/lib/mysql #挂载 MySQL数据\\n  redis:\\n    image: redis:4.0.14\\n    container_name: redis\\n    command: redis-server /usr/local/etc/redis/redis.conf --appendonly yes\\n    volumes:\\n      - /chinahrss/redis/data:/data #挂载 Redis数据\\n      - /chinahrss/redis/conf/redis.conf:/usr/local/etc/redis/redis.conf #挂载 Redis配置\\n    ports:\\n      - 16379:6379\\n  rabbitmq:\\n    image: rabbitmq:3.7.15-management\\n    container_name: rabbitmq\\n    volumes:\\n      - /chinahrss/rabbitmq/data:/var/lib/rabbitmq #挂载 RabbitMQ数据\\n      - /chinahrss/rabbitmq/log:/var/log/rabbitmq #挂载 RabbitMQ日志\\n    ports:\\n      - 5673:5672\\n      - 15673:15672\\n\")])])]),t(\"p\",[s._v(\"因为原有的端口都被占用了，我改了端口。\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"mysql：13306\")]),s._v(\" \"),t(\"li\",[s._v(\"Redis：16379\")]),s._v(\" \"),t(\"li\",[s._v(\"rabbitmq：5673 和 15673\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_2-3-创建挂载目录\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-3-创建挂载目录\"}},[s._v(\"#\")]),s._v(\" 2.3 创建挂载目录\")]),s._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"mkdir -p /chinahrss/mysql/data /chinahrss/redis/data /chinahrss/redis/conf \\\\\\n /chinahrss/rabbitmq/data /chinahrss/rabbitmq/log\\n\")])])]),t(\"h3\",{attrs:{id:\"_2-4-创建redis配置文件redis-conf\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-4-创建redis配置文件redis-conf\"}},[s._v(\"#\")]),s._v(\" 2.4 创建Redis配置文件\"),t(\"code\",[s._v(\"redis.conf\")]),s._v(\"：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"touch /chinahrss/redis/conf/redis.conf\\n\")])])]),t(\"p\",[s._v(\"因为我使用的是Redis默认配置，所以并没有在该配置文件里编写任何内容。\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_2-5-运行docker-compose\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-5-运行docker-compose\"}},[s._v(\"#\")]),s._v(\" 2.5 运行docker-compose\")]),s._v(\" \"),t(\"p\",[s._v(\"准备完毕后，将目录切换到/chinahrss/third-part，然后运行\"),t(\"code\",[s._v(\"docker-compose up -d\")]),s._v(\"启动：\")]),s._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:a(634),alt:\"image-20200129210656858\"}})]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_2-6-连接测试\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-6-连接测试\"}},[s._v(\"#\")]),s._v(\" 2.6 连接测试\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_2-6-1-mysql连接测试\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-6-1-mysql连接测试\"}},[s._v(\"#\")]),s._v(\" 2.6.1 Mysql连接测试\")]),s._v(\" \"),t(\"p\",[s._v(\"使用Navicat连接MySQL\")]),s._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:a(635),alt:\"image-20200129212504561\"}})]),s._v(\" \"),t(\"p\",[s._v(\"连接成功\")]),s._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:a(636),alt:\"image-20200129212520066\"}})]),s._v(\" \"),t(\"p\",[s._v(\"创建数据库\")]),s._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:a(637),alt:\"image-20200129212808981\"}})]),s._v(\" \"),t(\"p\",[s._v(\"最后导入chinahrss_cloud_base SQL和zipkin相关SQL，导入后库表如下所示：\")]),s._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:a(638),alt:\"image-20200129212958440\"}})]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_2-6-2-连接redis\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-6-2-连接redis\"}},[s._v(\"#\")]),s._v(\" 2.6.2 连接Redis\")]),s._v(\" \"),t(\"p\",[s._v(\"使用Redis Desktop Manager看看能否成功连接Redis：\")]),s._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:a(639),alt:\"image-20200129213232963\"}})]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_2-6-3-连接rabbitmq测试\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-6-3-连接rabbitmq测试\"}},[s._v(\"#\")]),s._v(\" 2.6.3 连接RabbitMQ测试\")]),s._v(\" \"),t(\"p\",[s._v(\"浏览器访问 http://120.79.200.111:15673/\")]),s._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:a(640),alt:\"image-20200129213558080\"}})]),s._v(\" \"),t(\"p\",[s._v(\"默认用户名和密码都为guest。在Admin标签页里新建一个用户，用户名为chinahrss，密码为123456，角色为管理员：\")]),s._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:a(641),alt:\"image-20200129213748137\"}})]),s._v(\" \"),t(\"p\",[s._v(\"然后对chinahrss用户授权，点击chinahrss用户：\")]),s._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:a(642),alt:\"image-20200129213840855\"}})]),s._v(\" \"),t(\"p\",[s._v(\"点击Set Permission按钮：\")]),s._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:a(643),alt:\"image-20200129213921866\"}})]),s._v(\" \"),t(\"p\",[s._v(\"至此第三方服务都准备完毕，接下来开始部署我们自己的微服务。\")]),s._v(\" \"),t(\"h2\",{attrs:{id:\"_3-部署-nacos\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-部署-nacos\"}},[s._v(\"#\")]),s._v(\" 3. 部署 nacos\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_3-1-新建docker-compose-yml\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-1-新建docker-compose-yml\"}},[s._v(\"#\")]),s._v(\" 3.1 新建docker-compose.yml\")]),s._v(\" \"),t(\"p\",[s._v(\"在\"),t(\"code\",[s._v(\"/chinahrss/nacos\")]),s._v(\" 目录下新建docker-compose.yml文件\")]),s._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"vim /chinahrss/nacos/docker-compose.yml\\n\")])])]),t(\"p\",[s._v(\"内容如下\")]),s._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v('version: \\'3\\'\\n\\nservices:\\n  nacos:\\n    image: nacos/nacos-server:latest\\n    container_name: nacos-standalone-mysql\\n    environment:\\n      - \"PREFER_HOST_MODE=hostname\"\\n      - \"MODE=standalone\"\\n      - \"SPRING_DATASOURCE_PLATFORM=mysql\"\\n      - \"MYSQL_MASTER_SERVICE_HOST=120.79.200.111\"\\n      - \"MYSQL_MASTER_SERVICE_DB_NAME=chinahrss_nacos\"\\n      - \"MYSQL_MASTER_SERVICE_PORT=13306\"\\n      - \"MYSQL_MASTER_SERVICE_USER=root\"\\n      - \"MYSQL_MASTER_SERVICE_PASSWORD=123456\"\\n      - \"MYSQL_SLAVE_SERVICE_HOST=120.79.200.111\"\\n      - \"MYSQL_SLAVE_SERVICE_PORT=13306\"\\n    volumes:\\n      - /chinahrss/nacos/standalone-logs/:/home/nacos/logs\\n    ports:\\n      - 8001:8848\\n    restart: on-failure\\n')])])]),t(\"p\",[s._v(\"注意事项\")]),s._v(\" \"),t(\"ul\",[t(\"li\",[s._v(\"mysql 的数据库必须要两个主从，两个一样也可以\")]),s._v(\" \"),t(\"li\",[s._v(\"端口我改成了8001\")])]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_3-2-新建对应的数据库\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-2-新建对应的数据库\"}},[s._v(\"#\")]),s._v(\" 3.2 新建对应的数据库\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_3-3-启动nacos\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-3-启动nacos\"}},[s._v(\"#\")]),s._v(\" 3.3 启动nacos\")]),s._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"docker-compose up -d\\n\")])])]),t(\"h3\",{attrs:{id:\"_3-3-浏览nacos\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-3-浏览nacos\"}},[s._v(\"#\")]),s._v(\" 3.3 浏览nacos\")]),s._v(\" \"),t(\"p\",[s._v(\"http://120.79.200.111:8001/nacos/\")]),s._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:a(644),alt:\"image-20200130115355107\"}})]),s._v(\" \"),t(\"h2\",{attrs:{id:\"_3-部署微服务\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-部署微服务\"}},[s._v(\"#\")]),s._v(\" 3. 部署微服务\")]),s._v(\" \"),t(\"h3\",{attrs:{id:\"_3-1-新建docker-compose文件\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-1-新建docker-compose文件\"}},[s._v(\"#\")]),s._v(\" 3.1 新建Docker Compose文件\")]),s._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v(\"mkdir -p /chinahrss/chinahrss-cloud\\nvim /chinahrss/chinahrss-cloud/docker-compose.yml\\n\")])])]),t(\"p\",[s._v(\"其内容如下所示：\")]),s._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[t(\"code\",[s._v('version: \\'3\\'\\n\\nservices:\\n  febs-register:\\n    image: febs-register:latest # 指定基础镜像，就是上一节中我们自己构建的镜像\\n    container_name: febs-register # 容器名称\\n    volumes:\\n      - \"/febs/log:/log\" #日志挂载\\n    command:\\n      - \"--febs-register=192.168.33.10\" # 通过command指定地址变量值\\n      - \"--febs-monitor-admin=192.168.33.10\"\\n    ports:\\n      - 8001:8001 # 端口映射\\n  febs-monitor-admin:\\n    image: febs-monitor-admin:latest\\n    container_name: febs-monitor-admin\\n    volumes:\\n      - \"/febs/log:/log\"\\n    ports:\\n      - 8401:8401\\n  febs-gateway:\\n    image: febs-gateway:latest\\n    container_name: febs-gateway\\n    depends_on:\\n      - febs-register\\n    volumes:\\n      - \"/febs/log:/log\"\\n    command:\\n      - \"--febs-register=192.168.33.10\"\\n      - \"--febs-monitor-admin=192.168.33.10\"\\n    ports:\\n      - 8301:8301\\n  febs-auth:\\n    image: febs-auth:latest\\n    container_name: febs-auth\\n    depends_on:\\n      - febs-register\\n    volumes:\\n      - \"/febs/log:/log\"\\n    command:\\n      - \"--mysql.url=192.168.33.10\"\\n      - \"--redis.url=192.168.33.10\"\\n      - \"--febs-register=192.168.33.10\"\\n      - \"--febs-monitor-admin=192.168.33.10\"\\n  febs-server-system:\\n    image: febs-server-system:latest\\n    container_name: febs-server-system\\n    depends_on:\\n      - febs-register\\n    volumes:\\n      - \"/febs/log:/log\"\\n    command:\\n      - \"--mysql.url=192.168.33.10\"\\n      - \"--rabbitmq.url=192.168.33.10\"\\n      - \"--febs-register=192.168.33.10\"\\n      - \"--febs-monitor-admin=192.168.33.10\"\\n      - \"--febs-gateway=192.168.33.10\"\\n  febs-server-test:\\n    image: febs-server-test:latest\\n    container_name: febs-server-test\\n    depends_on:\\n      - febs-register\\n    volumes:\\n      - \"/febs/log:/log\"\\n    command:\\n      - \"--rabbitmq.url=192.168.33.10\"\\n      - \"--febs-register=192.168.33.10\"\\n      - \"--febs-monitor-admin=192.168.33.10\"\\n      - \"--febs-gateway=192.168.33.10\"\\n  zipkin-server:\\n    image: zipkin-server\\n    container_name: zipkin-server\\n    command:\\n      - \"--server.port=8402\"\\n      - \"--zipkin.storage.type=mysql\"\\n      - \"--zipkin.storage.mysql.db=febs_cloud_base\"\\n      - \"--zipkin.storage.mysql.username=root\"\\n      - \"--zipkin.storage.mysql.password=123456\"\\n      - \"--zipkin.storage.mysql.host=192.168.33.10\"\\n      - \"--zipkin.storage.mysql.port=3306\"\\n      - \"--zipkin.collector.rabbitmq.addresses=192.168.33.10:5672\"\\n      - \"--zipkin.collector.rabbitmq.username=febs\"\\n      - \"--zipkin.collector.rabbitmq.password=123456\"\\n    ports:\\n      - 8402:8402\\n')])])])])}),[],!1,null,null,null);e.default=n.exports},634:function(s,e,a){s.exports=a.p+\"assets/img/image-20200129210656858.97b1cfee.png\"},635:function(s,e,a){s.exports=a.p+\"assets/img/image-20200129212504561.47608832.png\"},636:function(s,e,a){s.exports=a.p+\"assets/img/image-20200129212520066.e3f51e30.png\"},637:function(s,e,a){s.exports=a.p+\"assets/img/image-20200129212808981.75b61449.png\"},638:function(s,e,a){s.exports=a.p+\"assets/img/image-20200129212958440.0bed4861.png\"},639:function(s,e,a){s.exports=a.p+\"assets/img/image-20200129213232963.a1a251e2.png\"},640:function(s,e,a){s.exports=a.p+\"assets/img/image-20200129213558080.85e4c08f.png\"},641:function(s,e,a){s.exports=a.p+\"assets/img/image-20200129213748137.70a87dac.png\"},642:function(s,e,a){s.exports=a.p+\"assets/img/image-20200129213840855.c939eae0.png\"},643:function(s,e,a){s.exports=a.p+\"assets/img/image-20200129213921866.418f6af1.png\"},644:function(s,e,a){s.exports=a.p+\"assets/img/image-20200130115355107.a8feb37c.png\"}}]);","extractedComments":[]}