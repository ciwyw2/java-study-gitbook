{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[282],{1244:function(t,a,e){\"use strict\";e.r(a);var n=e(42),r=Object(n.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[e(\"h1\",{attrs:{id:\"spring-data-jpa使用getone方法报错-method-threw-org-hibernate-lazyinitializationexception\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#spring-data-jpa使用getone方法报错-method-threw-org-hibernate-lazyinitializationexception\"}},[t._v(\"#\")]),t._v(\" Spring Data JPA使用getOne方法报错：Method threw 'org.hibernate.LazyInitializationException\")]),t._v(\" \"),e(\"h2\",{attrs:{id:\"_1-背景\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-背景\"}},[t._v(\"#\")]),t._v(\" 1. 背景\")]),t._v(\" \"),e(\"p\",[t._v(\"之前项目一直用 jpa的dao.getOne() 都是正常的，但是加入线程池后，程序直接卡主不动。debug 后发现，提示\")]),t._v(\" \"),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[t._v(\"Method threw 'org.hibernate.LazyInitializationException' exception. Cannot evaluate com.xxx.xxx._$$_jvst6a8_a.toString()\\n\")])])]),e(\"p\",[t._v(\"为什么会出现这个问题呢？\")]),t._v(\" \"),e(\"h2\",{attrs:{id:\"_2-原因\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-原因\"}},[t._v(\"#\")]),t._v(\" 2. 原因\")]),t._v(\" \"),e(\"p\",[e(\"strong\",[t._v(\"getOne 是懒加载\")]),t._v(\"。每次初始化一个实体的关联就会创建一个\"),e(\"strong\",[t._v(\"临时的session来加载\")]),t._v(\"，每个临时的session都会获取一个\"),e(\"strong\",[t._v(\"临时的数据库连接\")]),t._v(\"，\"),e(\"strong\",[t._v(\"开启一个新的事物\")]),t._v(\"。这就导致对底层连接池压力很大，而且事物日志也会被每次flush.\")]),t._v(\" \"),e(\"p\",[t._v(\"设想一下：假如我们查询了一个分页list每次查出1000条，这个实体有三个lazy关联对象,那么，恭喜你，你至少需要创建3000个临时session+connection+transaction.\")]),t._v(\" \"),e(\"h2\",{attrs:{id:\"_3-解决方案\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_3-解决方案\"}},[t._v(\"#\")]),t._v(\" 3. 解决方案\")]),t._v(\" \"),e(\"ul\",[e(\"li\",[e(\"p\",[t._v(\"增加配置\")]),t._v(\" \"),e(\"p\",[t._v(\"getOne 是懒加载，需要增加这个配置：\")]),t._v(\" \"),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[t._v(\"spring.jpa.properties.hibernate.enable_lazy_load_no_trans=true\\n\")])])]),e(\"p\",[t._v(\"这种方法不太友好，\"),e(\"strong\",[t._v(\"不建议使用\")])])]),t._v(\" \"),e(\"li\",[e(\"p\",[t._v(\"改用findOne 或 findById\")]),t._v(\" \"),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[t._v(\"// findOne\\nExample<MyEntity> example = Example.of(entity);\\nMyEntity myEntity = riskWarnDao.findOne(example).get();\\n\\n// findById\\nMyEntity myEntity = riskWarnDao.findById(idno).get();\\n\")])])])])]),t._v(\" \"),e(\"h2\",{attrs:{id:\"参考文章\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#参考文章\"}},[t._v(\"#\")]),t._v(\" 参考文章\")]),t._v(\" \"),e(\"p\",[e(\"a\",{attrs:{href:\"https://www.itdaan.com/blog/2018/12/19/286dcc4fd95fa33a5e22901e4ecc9832.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"Spring Data JPA使用getOne方法报错：Method threw 'org.hibernate.LazyInitializationException' exception. Cannot evaluat\"),e(\"OutboundLink\")],1)])])}),[],!1,null,null,null);a.default=r.exports}}]);","extractedComments":[]}