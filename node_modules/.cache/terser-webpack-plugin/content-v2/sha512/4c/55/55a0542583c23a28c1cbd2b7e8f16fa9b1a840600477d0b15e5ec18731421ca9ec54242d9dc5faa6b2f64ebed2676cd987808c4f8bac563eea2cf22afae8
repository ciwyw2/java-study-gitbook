{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{1301:function(t,a,e){\"use strict\";e.r(a);var r=e(42),s=Object(r.a)({},(function(){var t=this,a=t.$createElement,r=t._self._c||a;return r(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":t.$parent.slotKey}},[r(\"h1\",{attrs:{id:\"skywalking收集之grpc代理\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#skywalking收集之grpc代理\"}},[t._v(\"#\")]),t._v(\" SkyWalking收集之gRPC代理\")]),t._v(\" \"),r(\"h2\",{attrs:{id:\"_1-简介\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_1-简介\"}},[t._v(\"#\")]),t._v(\" 1. 简介\")]),t._v(\" \"),r(\"p\",[t._v(\"在微服务体系中，各个微服务分布在各个服务器上，SkyWalking也不例外。如果能通过内网ip访问还好，但是如果 \"),r(\"strong\",[t._v(\"SkyWalking 和 应用服务器 之间网络不通\")]),t._v(\"。那么他们之间如何建立关联。\")]),t._v(\" \"),r(\"p\",[t._v(\"我们首先肯定想到可以通过 nginx 代理到SkyWalking 服务器，但是实际代理过程中我们发现 skywalking-oap 收集采用的是gRPC代理，而不是基于 http。\")]),t._v(\" \"),r(\"h2\",{attrs:{id:\"_2-解决方案\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-解决方案\"}},[t._v(\"#\")]),t._v(\" 2. 解决方案\")]),t._v(\" \"),r(\"p\",[t._v(\"这里提供两个解决方案\")]),t._v(\" \"),r(\"ul\",[r(\"li\",[t._v(\"通过nginx代理gRPC端口\")]),t._v(\" \"),r(\"li\",[t._v(\"使用natapp等内网穿透以tcp 方式代理\")])]),t._v(\" \"),r(\"h3\",{attrs:{id:\"_2-1-通过nginx代理grpc端口\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-1-通过nginx代理grpc端口\"}},[t._v(\"#\")]),t._v(\" 2.1 通过nginx代理gRPC端口\")]),t._v(\" \"),r(\"h4\",{attrs:{id:\"_2-1-1-前置条件-nginx-支持http2\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-1-1-前置条件-nginx-支持http2\"}},[t._v(\"#\")]),t._v(\" 2.1.1 前置条件，\"),r(\"strong\",[t._v(\"nginx 支持http2\")])]),t._v(\" \"),r(\"p\",[r(\"a\",{attrs:{href:\"https://www.hi-linux.com/posts/24162.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"nginx支持http2\"),r(\"OutboundLink\")],1)]),t._v(\" \"),r(\"h4\",{attrs:{id:\"_2-1-2-配置\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-1-2-配置\"}},[t._v(\"#\")]),t._v(\" 2.1.2 配置\")]),t._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[t._v(\"  server {\\n    listen 8022 http2;\\n\\n    location / {\\n      grpc_pass grpc://localhost:11800; # 映射到SkyWalking的 gRPC 端口11800\\n    }\\n  }\\n\")])])]),r(\"h3\",{attrs:{id:\"_2-2-通过natapp等内网穿透以tcp-方式代理\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-2-通过natapp等内网穿透以tcp-方式代理\"}},[t._v(\"#\")]),t._v(\" 2.2 通过natapp等内网穿透以tcp 方式代理\")]),t._v(\" \"),r(\"h3\",{attrs:{id:\"_2-2-1-下载natapp并正确配置启动\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-2-1-下载natapp并正确配置启动\"}},[t._v(\"#\")]),t._v(\" 2.2.1 下载natapp并正确配置启动\")]),t._v(\" \"),r(\"p\",[r(\"a\",{attrs:{href:\"https://natapp.cn/article/natapp_newbie\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"NATAPP1分钟快速新手图文教程\"),r(\"OutboundLink\")],1)]),t._v(\" \"),r(\"h3\",{attrs:{id:\"_2-2-2-购买tcp隧道\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-2-2-购买tcp隧道\"}},[t._v(\"#\")]),t._v(\" 2.2.2 购买tcp隧道\")]),t._v(\" \"),r(\"p\",[r(\"img\",{attrs:{src:e(732),alt:\"image-20200204210513387\"}})]),t._v(\" \"),r(\"h3\",{attrs:{id:\"_2-2-3-启动natapp\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-2-3-启动natapp\"}},[t._v(\"#\")]),t._v(\" 2.2.3 启动natapp\")]),t._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[t._v(\"./natapp -authtoken=1027bdec1c8d8709\\n\")])])]),r(\"p\",[r(\"img\",{attrs:{src:e(733),alt:\"image-20200204210720400\"}})]),t._v(\" \"),r(\"p\",[t._v(\"上面启动是前台启动，关闭页面就停止了。所以需要使用后台启动\")]),t._v(\" \"),r(\"p\",[r(\"strong\",[t._v(\"后台启动\")])]),t._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[t._v(\"nohup ./natapp -authtoken=d0ae75441459014e -log=stdout -loglevel=ERROR &\\n\")])])]),r(\"p\",[r(\"img\",{attrs:{src:e(734),alt:\"image-20200205131045127\"}})]),t._v(\" \"),r(\"p\",[t._v(\"查看是否启动\")]),t._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[t._v(\"ps -ef|grep natapp\\n\")])])]),r(\"p\",[r(\"img\",{attrs:{src:e(735),alt:\"image-20200205132814470\"}})]),t._v(\" \"),r(\"h3\",{attrs:{id:\"_2-2-4-backend-service-地址更改\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_2-2-4-backend-service-地址更改\"}},[t._v(\"#\")]),t._v(\" 2.2.4 backend_service 地址更改\")]),t._v(\" \"),r(\"div\",{staticClass:\"language- extra-class\"},[r(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[r(\"code\",[t._v(\"-Dskywalking.collector.backend_service=server.natappfree.cc:37444\\n\")])])]),r(\"p\",[r(\"img\",{attrs:{src:e(736),alt:\"image-20200204213810001\"}})]),t._v(\" \"),r(\"h2\",{attrs:{id:\"参考文章\"}},[r(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#参考文章\"}},[t._v(\"#\")]),t._v(\" 参考文章\")]),t._v(\" \"),r(\"p\",[r(\"a\",{attrs:{href:\"https://www.nginx.com/blog/nginx-1-13-10-grpc/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"Introducing gRPC Support with NGINX 1.13.10\"),r(\"OutboundLink\")],1)]),t._v(\" \"),r(\"p\",[r(\"a\",{attrs:{href:\"https://www.hi-linux.com/posts/24162.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"nginx支持http2\"),r(\"OutboundLink\")],1)]),t._v(\" \"),r(\"p\",[r(\"a\",{attrs:{href:\"https://natapp.cn/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[t._v(\"natapp\"),r(\"OutboundLink\")],1)])])}),[],!1,null,null,null);a.default=s.exports},732:function(t,a,e){t.exports=e.p+\"assets/img/image-20200204210513387.01fcc006.png\"},733:function(t,a,e){t.exports=e.p+\"assets/img/image-20200204210720400.088ba588.png\"},734:function(t,a,e){t.exports=e.p+\"assets/img/image-20200205131045127.2faa90fc.png\"},735:function(t,a,e){t.exports=e.p+\"assets/img/image-20200205132814470.d3fecaa4.png\"},736:function(t,a,e){t.exports=e.p+\"assets/img/image-20200204213810001.69bdfad2.png\"}}]);","extractedComments":[]}