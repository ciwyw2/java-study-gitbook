(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{1237:function(s,a,t){"use strict";t.r(a);var r=t(42),e=Object(r.a)({},(function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("h1",{attrs:{id:"chinahrss微服务docker化"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#chinahrss微服务docker化"}},[s._v("#")]),s._v(" chinahrss微服务Docker化")]),s._v(" "),r("h2",{attrs:{id:"_1-项目打包"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_1-项目打包"}},[s._v("#")]),s._v(" 1.项目打包")]),s._v(" "),r("p",[s._v("项目根目录下执行")]),s._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("mvn clean package -Dmaven.test.skip=true\n")])])]),r("p",[s._v("每个微服务（除了聚合模块）target目录下会有个可运行jar包，比如chinahrss-auth模块：")]),s._v(" "),r("p",[r("img",{attrs:{src:t(645),alt:"image-20200129201147695"}})]),s._v(" "),r("h2",{attrs:{id:"_2-服务器创建相关目录"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-服务器创建相关目录"}},[s._v("#")]),s._v(" 2. 服务器创建相关目录")]),s._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("mkdir -p /chinahrss/chinahrss-auth /chinahrss/chinahrss-gateway \\\n/chinahrss/chinahrss-monitor-admin /chinahrss/zipkin-server /chinahrss/chinahrss-register \\\n/chinahrss/chinahrss-server-system /chinahrss/chinahrss-server-test\n")])])]),r("h2",{attrs:{id:"_3-对文件夹授权"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_3-对文件夹授权"}},[s._v("#")]),s._v(" 3. 对文件夹授权")]),s._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("chmod 777 -R /chinahrss\n")])])]),r("h2",{attrs:{id:"_4-将jar上传到服务器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-将jar上传到服务器"}},[s._v("#")]),s._v(" 4. 将jar上传到服务器")]),s._v(" "),r("p",[s._v("将文件上传到对应目录下，如本地的"),r("code",[s._v("chinahrss-auth-0.0.1-SNAPSHOT.jar")]),s._v(" 就上传到 "),r("code",[s._v("/chinahrss/chinahrss-auth")])]),s._v(" "),r("p",[s._v("上传好后，运行一下目录，看是否都上传成功：")]),s._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("ls /chinahrss/chinahrss-auth /chinahrss/chinahrss-gateway \\\n/chinahrss/chinahrss-monitor-admin /chinahrss/zipkin-server /chinahrss/chinahrss-register \\\n/chinahrss/chinahrss-server-system /chinahrss/chinahrss-server-test\n")])])]),r("p",[r("img",{attrs:{src:t(646),alt:"image-20200129202700966"}})]),s._v(" "),r("h2",{attrs:{id:"_5-构建docker镜像"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_5-构建docker镜像"}},[s._v("#")]),s._v(" 5. 构建Docker镜像")]),s._v(" "),r("p",[s._v("在 "),r("code",[s._v("/chinahrss/chinahrss-auth")]),s._v(" 模块下创建一个Dockerfile")]),s._v(" "),r("p",[r("img",{attrs:{src:t(647),alt:"image-20200129203014295"}})]),s._v(" "),r("p",[s._v("内容如下所示：")]),s._v(" "),r("div",{staticClass:"language-dockerfile extra-class"},[r("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[r("code",[r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("FROM")]),s._v(" openjdk"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8u212"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("jre\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("MAINTAINER")]),s._v(" zsz 312905679@qq.com\n\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("COPY")]),s._v(" chinahrss"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("auth"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("0.0.1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("SNAPSHOT.jar /chinahrss/chinahrss"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("auth"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("0.0.1"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("SNAPSHOT.jar\n\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ENTRYPOINT")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Xmx256m"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/chinahrss/chinahrss-auth-1.0-SNAPSHOT.jar"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])])]),r("p",[s._v("上面脚本包含4条命令：")]),s._v(" "),r("ol",[r("li",[r("p",[r("code",[s._v("FROM openjdk:8u212-jre")])]),s._v(" "),r("p",[s._v("表示由"),r("code",[s._v("openjdk:8u212-jre")]),s._v("基础镜像构建。因为我们的项目使用的是JDK 1.8，所以我们要依赖于1.8版本的JDK镜像构建，openjdk官方Docker镜像仓库为https://hub.docker.com/_/openjdk?tab=tags，我挑了个体积相对较小的openjdk:8u212-jre；")])]),s._v(" "),r("li",[r("p",[r("code",[s._v("MAINTAINER zsz 312905679@qq.com")])]),s._v(" "),r("p",[s._v("指定镜像的作者及联系方式；")])]),s._v(" "),r("li",[r("p",[r("code",[s._v("COPY chinahrss-auth-1.0-SNAPSHOT.jar /chinahrss/chinahrss-auth-1.0-SNAPSHOT.jar")])]),s._v(" "),r("p",[s._v("表示将当前目录（/chinahrss/chinahrss-auth）下的chinahrss-auth-1.0-SNAPSHOT.jar拷贝到"),r("code",[s._v("openjdk:8u212-jre")]),s._v("镜像里的/chinahrss目录下，名称也为chinahrss-auth-0.0.1-SNAPSHOT.jar；")])]),s._v(" "),r("li",[r("p",[r("code",[s._v('ENTRYPOINT ["java", "-Xmx256m", "-jar", "/febs/febs-auth-1.0-SNAPSHOT.jar"]')])]),s._v(" "),r("p",[s._v("表示运行"),r("code",[s._v("java -jar")]),s._v("运行镜像里的jar包，JVM内存最大分配为256m（因为要运行的微服务较多并且虚拟机内存只有6GB，所以内存分配小了点，实际可以根据宿主服务器的配置做出相应调整）。")])])]),s._v(" "),r("p",[s._v("DockerFile创建好后，在/chinahrss/chinahrss-auth目录下运行以下命令构建镜像：")]),s._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("docker build -t chinahrss-auth:v1 .\n")])])]),r("p",[s._v("第一次构建的时候因为要下载"),r("code",[s._v("openjdk:8u212-jre")]),s._v("镜像，所以速度较慢，耐心等待即可，构建好后终端输出如下所示：")]),s._v(" "),r("p",[r("img",{attrs:{src:t(648),alt:"image-20200129204734435"}})]),s._v(" "),r("p",[s._v("查看当前镜像：")]),s._v(" "),r("div",{staticClass:"language- extra-class"},[r("pre",{pre:!0,attrs:{class:"language-text"}},[r("code",[s._v("docker images\n")])])]),r("p",[r("img",{attrs:{src:t(649),alt:"image-20200129204825052"}})])])}),[],!1,null,null,null);a.default=e.exports},645:function(s,a,t){s.exports=t.p+"assets/img/image-20200129201147695.de5eef14.png"},646:function(s,a,t){s.exports=t.p+"assets/img/image-20200129202700966.21405c09.png"},647:function(s,a,t){s.exports=t.p+"assets/img/image-20200129203014295.623f126b.png"},648:function(s,a,t){s.exports=t.p+"assets/img/image-20200129204734435.d15ef9a5.png"},649:function(s,a,t){s.exports=t.p+"assets/img/image-20200129204825052.81984b85.png"}}]);