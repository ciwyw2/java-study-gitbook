(window.webpackJsonp=window.webpackJsonp||[]).push([[381],{1075:function(e,a,t){"use strict";t.r(a);var r=t(42),s=Object(r.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"环境与profile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境与profile"}},[e._v("#")]),e._v(" 环境与profile")]),e._v(" "),t("h2",{attrs:{id:"_1-环境与profile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-环境与profile"}},[e._v("#")]),e._v(" 1.环境与profile")]),e._v(" "),t("p",[e._v("环境迁移中某些环境相关的配置并不适合迁移到生产环境中，甚至迁移过去也无法正常工作")]),e._v(" "),t("p",[e._v("如")]),e._v(" "),t("ul",[t("li",[e._v("数据库配置")]),e._v(" "),t("li",[e._v("加密算法")])]),e._v(" "),t("h3",{attrs:{id:"_1-1-使用java注解配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-使用java注解配置"}},[e._v("#")]),e._v(" 1.1 使用Java注解配置")]),e._v(" "),t("h4",{attrs:{id:"_1-1-1-类级别-profile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-类级别-profile"}},[e._v("#")]),e._v(" 1.1.1 类级别@Profile")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('@Configuration\n@Profile("dev")\npublic class DevConfig(){\n    ...\n    @Bean\n    public Datasource datasource(){\n        ...\n    }\n}\n')])])]),t("p",[e._v("配置类中的bean 只有在dev profile 激活才创建，如果没有激活那么带@Bean 注解的方法都会忽略掉。")]),e._v(" "),t("h4",{attrs:{id:"方法级的-profile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#方法级的-profile"}},[e._v("#")]),e._v(" "),t("strong",[e._v("方法级的@Profile")])]),e._v(" "),t("p",[e._v("在Spring 3.2开始就支持方法级别的@Profile")]),e._v(" "),t("p",[e._v("注：没有指定profile 的bean始终都会被创建")]),e._v(" "),t("h3",{attrs:{id:"_1-2-在xml中配置profile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-在xml中配置profile"}},[e._v("#")]),e._v(" 1.2 在XML中配置profile")]),e._v(" "),t("h4",{attrs:{id:"_1-2-1-可以通过-元素的profile属性-配置profile-bean"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-可以通过-元素的profile属性-配置profile-bean"}},[e._v("#")]),e._v(" 1.2.1 可以通过"),t("beans",[e._v(" 元素的profile属性，配置profile bean")])],1),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('<beans \n\t...\n\tprofile="dev"/>\n\t...\t\n</beans>\n')])])]),t("h4",{attrs:{id:"_1-2-2-在中嵌套设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-在中嵌套设置"}},[e._v("#")]),e._v(" 1.2.2 在"),t("beans",[e._v("中嵌套"),t("beans",[e._v("设置")])],1)],1),e._v(" "),t("p",[e._v("这样就能将他们定义在一个xml，不需要重复定义")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('<beans \n\t...\n\t/>\n\t<beans profile="dev">\n\t...\n\t</beans>\n\t<beans profile="prod">\n\t...\n\t</beans>\n</beans>\n')])])]),t("h3",{attrs:{id:"_1-3-激活profile"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-激活profile"}},[e._v("#")]),e._v(" 1.3 激活profile")]),e._v(" "),t("p",[e._v("确定那个profile 处于激活状态，需要依赖两个独立的属性")]),e._v(" "),t("ul",[t("li",[e._v("spring.profiles.active")]),e._v(" "),t("li",[e._v("spring.profiles.defaule")])]),e._v(" "),t("h4",{attrs:{id:"_1-3-1-激活规则"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-1-激活规则"}},[e._v("#")]),e._v(" 1.3.1 激活规则")]),e._v(" "),t("ol",[t("li",[e._v("如果设置了active属性的话，由active的值确定激活哪个profile")]),e._v(" "),t("li",[e._v("如果没设置active，那么就由defaule的值决定")]),e._v(" "),t("li",[e._v("active和defaule 都没有设置自，那就没有激活的profile，那么只会创建那些没有定义在profile 的bean")])]),e._v(" "),t("h4",{attrs:{id:"_1-3-2-设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-2-设置"}},[e._v("#")]),e._v(" 1.3.2 设置")]),e._v(" "),t("p",[e._v("spring 提供了多种设置方法")]),e._v(" "),t("ul",[t("li",[e._v("作为DispatcherServlet的初始化参数")]),e._v(" "),t("li",[e._v("作为Web应用的上下文参数")]),e._v(" "),t("li",[e._v("作为JNDI条目")]),e._v(" "),t("li",[e._v("作为环境变量")]),e._v(" "),t("li",[e._v("作为JVM的系统属性")]),e._v(" "),t("li",[e._v("在集成测试类上，使用@ActiveProfiles注解设置")])]),e._v(" "),t("h4",{attrs:{id:"_1-4-使用profile进行测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-使用profile进行测试"}},[e._v("#")]),e._v(" 1.4 使用Profile进行测试")]),e._v(" "),t("p",[e._v("Spring 提供了@ActiveProfiles注解指定运行测试时要激活哪个profile")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('@RunWith(SpringJUnit4ClassRunner.class)\n@ContextConfiguration(classes={PersistenceTestConfig.class})\n@ActiveProfiles("dev")\npublic class PersistenceTest{\n    \n}\n')])])])])}),[],!1,null,null,null);a.default=s.exports}}]);